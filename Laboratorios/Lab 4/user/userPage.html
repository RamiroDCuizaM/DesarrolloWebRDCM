<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Correo Web</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
      crossorigin="anonymous"
    ></script>
    <style>
      body {
        height: 100vh;
      }

      .sidebar {
        background-color: #f1f3f4;
        height: 100%;
        padding-top: 1rem;
      }

      .sidebar a {
        display: block;
        padding: 10px;
        color: #202124;
        text-decoration: none;
      }

      .sidebar a:hover {
        background-color: #dadce0;
      }

      .content {
        padding: 20px;
      }

      .sidebar a.active {
        background-color: #c1d8f0;
        font-weight: bold;
        border-left: 4px solid #1a73e8;
      }
      .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background-color: #fff;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <!-- NAVBAR superior -->
    <nav class="navbar navbar-light bg-light border-bottom">
      <div class="container-fluid">
        <button class="btn" onclick="toggleMenu()">☰</button>
        <img
          src="../admin/Example/img\logo.png"
          alt="logo"
          width="30"
          class="d-inline-block align-text-top"
        />
        <span class="navbar-brand mb-0 h1 mx-auto ms-3">IntraMail</span>
        <div>
          <img
            src="profile.png"
            alt="Perfil"
            width="30"
            class="rounded-circle"
          />
        </div>
      </div>
    </nav>

    <!-- CONTENIDO PRINCIPAL -->
    <div class="container-fluid">
      <div class="row h-100">
        <!-- Menú lateral -->
        <div id="sidebar" class="col-md-2 sidebar">
          <a href="#" onclick="mostrar('entradaSection')"
            ><img src="../admin/Example/img\admC.png" alt="logo" width="30" />
            Bandeja de Entrada</a
          >
          <a href="#" onclick="mostrar('salidaSection')"
            ><img src="../admin/Example/img\icon_2.png" alt="logo" width="30" />
            Bandeja de Salida</a
          >
          <a href="#" onclick="mostrar('borradoresSection')"
            ><img src="../admin/Example/img\icon_3.png" alt="logo" width="30" />
            Borradores</a
          >
          <!-- <a href="#" onclick="mostrar('enviar')"><img src="img\icon_4.png" alt="logo"width="30">  Enviar Correo</a> -->
        </div>

        <!-- Panel derecho -->
        <div class="col-md-10 content" id="panel">
          <h4>Bienvenido</h4>
          <p>Selecciona una opción del menú.</p>
        </div>
      </div>
    </div>
    <div id="myModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div id="contenido-modal"></div>
      </div>
    </div>

    <script>
      function toggleMenu() {
        const sidebar = document.getElementById("sidebar");
        sidebar.classList.toggle("d-none");
      }
      function mostrar(pagina) {
        const contenido = document.getElementById("panel");

        // Remover la clase activa de todos los enlaces
        document.querySelectorAll(".sidebar a").forEach((link) => {
          link.classList.remove("active");
        });

        // Añadir clase activa al enlace clicado
        const linkActivo = Array.from(
          document.querySelectorAll(".sidebar a")
        ).find((a) => a.textContent.toLowerCase().includes(pagina));
        if (linkActivo) linkActivo.classList.add("active");

        fetch(pagina + ".html")
          .then((res) => {
            if (!res.ok) throw new Error("Página no encontrada");
            return res.text();
          })
          .then((data) => {
            contenido.innerHTML = data;

            if (pagina === "borradoresSection") {
              mostrarborradores();
            } else if (pagina === "salidaSection") {
              mostrarsalida();
            } else if (pagina === "entradaSection") {
              mostrarentrada();
            }
          })
          .catch((error) => {
            contenido.innerHTML =
              '<div class="alert alert-danger">No se pudo cargar la sección: ' +
              pagina +
              "</div>";
            console.error(error);
          });
      }
      function mostrarborradores() {
        let correosData;
        fetch("../php/readcorreosPendiente.php")
          .then((response) => response.json())
          .then((data) => {
            correosData = data.datos;
            console.log(correosData);
            console.log(correosData.length);
            let correosHTML = "";
            for (let i = 0; i < correosData.length; i++) {
              correosHTML += `<tr style="cursor: pointer;" onclick="window.location.href='leercorreo.html'">`;
              correosHTML += "<td>" + correosData[i].correo + "</td>";
              correosHTML += "<td>" + correosData[i].asunto + "</td>";
              correosHTML += "<td>" + correosData[i].fecha + "</td>";
              correosHTML += "<td>" + correosData[i].estado + "</td>";
              correosHTML += `<td>
                  <button class='btn btn-primary btn-sm' onclick="event.stopPropagation();">Enviar</button>
                  <button class='btn btn-danger btn-sm' onclick="event.stopPropagation(); borrarCorreo(${correosData[i].id})">Borrar</button>
                </td>`;
              correosHTML += "</tr>";
            }
            correos.innerHTML = correosHTML;
          })
          .catch((error) => {
            console.error("Error al cargar los correos:", error);
          });
      }
      function mostrarentrada() {
        let correosData;
        fetch("../php/readcorreosEntrada.php")
          .then((response) => response.json())
          .then((data) => {
            correosData = data.datos;
            console.log(correosData);
            console.log(correosData.length);
            let correosHTML = "";
            for (let i = 0; i < correosData.length; i++) {
              correosHTML += `<tr onclick="window.location.href='leercorreo.html'" style="cursor: pointer;">`;
              correosHTML += "<td>" + correosData[i].correo + "</td>";
              correosHTML += "<td>" + correosData[i].asunto + "</td>";
              correosHTML += "<td>" + correosData[i].fecha + "</td>";
              correosHTML += "<td>" + correosData[i].estado + "</td>";
              correosHTML += `<td>
                  <button class='btn btn-primary btn-sm' onclick="event.stopPropagation();">Enviar</button>
                  <button class='btn btn-danger btn-sm' onclick="event.stopPropagation(); borrarCorreo(${correosData[i].id})">Borrar</button>
                </td>`;
              correosHTML += "</tr>";
            }
            correos.innerHTML = correosHTML;
          })
          .catch((error) => {
            console.error("Error al cargar los correos:", error);
          });
      }
      function mostrarsalida() {
        let correosData;
        fetch("../php/readcorreosSalida.php")
          .then((response) => response.json())
          .then((data) => {
            correosData = data.datos;
            console.log(correosData);
            console.log(correosData.length);
            let correosHTML = "";
            for (let i = 0; i < correosData.length; i++) {
              correosHTML += `<tr style="cursor: pointer;" onclick="window.location.href='leercorreo.html'">`;
              correosHTML += "<td>" + correosData[i].correo + "</td>";
              correosHTML += "<td>" + correosData[i].asunto + "</td>";
              correosHTML += "<td>" + correosData[i].fecha + "</td>";
              correosHTML += "<td>" + correosData[i].estado + "</td>";
              correosHTML += `<td>
                  <button class='btn btn-primary btn-sm' onclick="event.stopPropagation();">Enviar</button>
                  <button class='btn btn-danger btn-sm' onclick="event.stopPropagation(); borrarCorreo(${correosData[i].id})">Borrar</button>
                </td>`;
              correosHTML += "</tr>";
            }
            correos.innerHTML = correosHTML;
          })
          .catch((error) => {
            console.error("Error al cargar los correos:", error);
          });
      }
      function borrarCorreo(id) {
        fetch(`../php/deletecorreo.php?id=${id}`)
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              alert("Correo borrado exitosamente");
              mostrarborradores();
            } else {
              alert("Error al borrar el correo");
            }
          })
          .catch((error) => {
            console.error("Error al borrar el correo:", error);
          });
      }
      //modal
      function redactar(){
        const modal = document.getElementById("myModal");
        const span = document.getElementsByClassName("close")[0];
        const contenidoModal = document.getElementById("contenido-modal");
        const tituloModal = document.getElementById("titulo-modal");

        modal.style.display = "block";
        fetch("modalEmail.html")
          .then((res) => {
            if (!res.ok) throw new Error("Página no encontrada");
            return res.text();
          })
          .then((data) => {
            contenidoModal.innerHTML = data;
          })
          .catch((error) => {
            contenidoModal.innerHTML =
              '<div class="alert alert-danger">No se pudo cargar la sección: ' +
              pagina +
              "</div>";
            console.error(error);
          });

        span.onclick = function () {
          modal.style.display = "none";
        };
      }
      function guardarCorreo(estado){
        const para = document.getElementById("para").value;
        const asunto = document.getElementById("asunto").value;
        const contenido = document.getElementById("contenido").value;

        fetch("../php/createcorreo.php", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            para: para,
            asunto: asunto,
            mensaje: contenido,
            estado: estado,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              alert("Correo guardado exitosamente");
              window.location.reload();
            } else {
              alert("Error al guardar el correo");
            }
          })
          .catch((error) => {
            console.error("Error al guardar el correo:", error);
          });
      }
    </script>
  </body>
</html>
